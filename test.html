<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sticker App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Include jsPDF & html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 10px;
        font-family: sans-serif;
        background: #f0f0f0;
      }

      .preview {
        display: flex;
        width: 100mm;
        height: 25mm;
        margin: 10px auto;
        border: 1px solid #ccc;
        background: white;
      }

      .sticker {
        width: 50mm;
        height: 25mm;
        border: 1px solid black;
        box-sizing: border-box;
        font-size: 10pt;
        padding: 2mm;
      }

      .buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 300px;
        margin: 0 auto;
        margin-top: 20px;
      }

      button {
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        background: #007bff;
        color: white;
        cursor: pointer;
      }

      button:hover {
        background: #0056b3;
      }

      .log {
        margin-top: 20px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
        background: #222;
        color: #0f0;
        padding: 10px;
        font-family: monospace;
        font-size: 12px;
        height: 150px;
        overflow-y: auto;
        white-space: pre-wrap;
        border-radius: 4px;
      }

      .title {
        text-align: center;
        font-weight: bold;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="title">Sticker App ‚Äì 100mm x 25mm</div>

    <div class="preview" id="stickerArea">
      <div class="sticker">
        <div><strong>Product:</strong> Widget C</div>
        <div><strong>Code:</strong> WGT-001</div>
        <div><strong>Qty:</strong> 5</div>
        <div><strong>Date:</strong> 2025-06-21</div>
      </div>
      <div class="sticker">
        <div><strong>Product:</strong> Widget D</div>
        <div><strong>Code:</strong> WGT-002</div>
        <div><strong>Qty:</strong> 10</div>
        <div><strong>Date:</strong> 2025-06-21</div>
      </div>
    </div>

    <div class="buttons">
      <button onclick="downloadPDF()">üì• Download PDF</button>
      <button onclick="sharePDF()">üì§ Try Share PDF</button>
      <button onclick="openPDF()">üîç Open PDF in New Tab</button>
      <button onclick="clearLog()">üßπ Clear Log</button>
      <button onclick="tryIntent()">üß™ Try Open in 'Print Label' App</button>
    </div>

    <div class="log" id="log">[App started...]</div>

    <script>
      function tryIntent() {
        const pdfUrl = 'https://example.com/stickers.pdf'; // Replace with real public PDF URL

        const intentUrl =
          'intent:' +
          pdfUrl +
          '#Intent;' +
          'scheme=https;' +
          'package=com.print.label;' +
          'type=application/pdf;' +
          'end;';

        log('‚è≥ Trying to open Print Label app using Intent...');
        window.location.href = intentUrl;
      }

      // Optional log output on screen
      function log(msg) {
        let logBox = document.getElementById('intentLog');
        if (!logBox) {
          logBox = document.createElement('pre');
          logBox.id = 'intentLog';
          logBox.style =
            'padding:10px;background:#111;color:#0f0;font-size:12px;';
          document.body.appendChild(logBox);
        }
        logBox.textContent += `\n${msg}`;
      }
    </script>

    <script>
      const { jsPDF } = window.jspdf;

      function log(message) {
        const logBox = document.getElementById('log');
        logBox.textContent += `\n[${new Date().toLocaleTimeString()}] ${message}`;
        logBox.scrollTop = logBox.scrollHeight;
      }

      function clearLog() {
        document.getElementById('log').textContent = '[Logs cleared]';
      }

      async function createPDFBlob() {
        log('Rendering sticker area to canvas...');
        const element = document.getElementById('stickerArea');
        try {
          const canvas = await html2canvas(element, { scale: 2 });
          const imgData = canvas.toDataURL('image/png');

          log('Generating PDF (100mm x 25mm)...');
          const doc = new jsPDF({
            orientation: 'landscape',
            unit: 'mm',
            format: [100, 25]
          });

          doc.addImage(imgData, 'PNG', 0, 0, 100, 25);
          log('PDF generation complete.');
          return doc.output('blob');
        } catch (err) {
          log('‚ùå Error creating PDF: ' + err.message);
          throw err;
        }
      }

      async function downloadPDF() {
        try {
          const blob = await createPDFBlob();
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = 'stickers.pdf';
          link.click();
          log('‚úÖ PDF downloaded.');
        } catch (err) {
          log('‚ùå Download failed.');
        }
      }

      async function openPDF() {
        try {
          const blob = await createPDFBlob();
          const url = URL.createObjectURL(blob);
          window.open(url, '_blank');
          log('üìÇ PDF opened in new tab.');
        } catch (err) {
          log('‚ùå Could not open PDF.');
        }
      }

      async function sharePDF() {
        log('Checking Web Share API support...');
        if (!navigator.canShare || !navigator.canShare({ files: [] })) {
          log('‚ùå Web Share API not supported or file sharing not available.');
          return;
        }

        try {
          const blob = await createPDFBlob();
          const file = new File([blob], 'stickers.pdf', {
            type: 'application/pdf'
          });
          log('üì§ Sharing PDF file...');
          await navigator.share({
            title: 'Sticker PDF',
            text: 'Generated sticker labels',
            files: [file]
          });
          log('‚úÖ PDF shared successfully.');
        } catch (err) {
          log('‚ùå Share failed: ' + err.message);
        }
      }
    </script>
  </body>
</html>
